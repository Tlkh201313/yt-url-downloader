version: '3.7'

services:
  # --- PHP Backend Service (Handles the downloading logic) ---
  backend:
    build: 
      context: .
      dockerfile: Dockerfile.php # Looks for our custom Dockerfile.php
    container_name: youtube-downloader-backend
    volumes:
      # Map the PHP files (download.php, video_info.php) for execution
      - .:/var/www/html
    expose:
      - 9000 # Standard port for PHP-FPM

  # --- Nginx Web Server (Serves the HTML and proxies requests to PHP) ---
  nginx:
    image: "nginx:latest"
    container_name: web-youtube-downloader
    volumes:
      # Map the HTML/JS frontend files
      - .:/var/www/html:ro
      # Map the custom Nginx config file
      - ./nginx.conf:/etc/nginx/conf.d/default.conf:ro
    ports:
      # Exposes the Nginx web server on your local machine port 5000
      - 5000:80
    depends_on:
      - backend
    restart: always